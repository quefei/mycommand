#!/bin/bash

export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

############################################################
#
#       1.位置参量
#
############################################################

set -eu
#set -x

echo_color()
{
        echo -e "\e[1m\e[40;$2m$1\e[0m"
}

echo_error()
{
        echo_color "$1" "31"
        exit 1
}

echo_warning()
{
        echo_color "$1" "33"
        sleep 5
}

if [[ "$(id -u)" != "0" ]]; then
        echo_error "Error: must run with root"
fi

############################################################
#
#       2.全局变量
#
############################################################

############################################################
#
#       3.初始化
#
############################################################

############################################################
#
#       4.次要函数
#
############################################################

############################################################
#
#       5.主要函数
#
############################################################

############################################################
#
#       6.次要操作
#
############################################################

############################################################
#
#       7.主要操作
#
############################################################
if ( dmesg | grep -in eth &> /dev/null ); then
        echo_error "Error: The network already exists"
fi

if [[ -n "$(ls kmod-*.rpm)" ]]; then
        KMOD_RPM=$(ls kmod-*.rpm)
else
        echo_error "Error: kmod not found"
fi

rpm -ivh "$KMOD_RPM"

cat > /etc/sysconfig/network-scripts/ifcfg-enp0s7 <<-"EOF"
NM_CONTROLLED=no
DEVICE=enp0s7
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.1.2
PREFIX=24
GATEWAY=192.168.1.1
DNS1=202.103.225.68
DNS2=202.103.224.68
EOF

systemctl stop NetworkManager
systemctl disable NetworkManager

#shutdown -r +1
shutdown -r now

############################################################
#
#       8.结束语
#
############################################################

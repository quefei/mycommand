#!/bin/bash

export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

############################################################
#
#       位置参量
#
############################################################
ARGUMENT1="$1"
ARGUMENT2="$2"
ARGUMENT3="$3"

set -eu
#set -x

if [[ "$(id -u)" != "0" ]]; then
        echo "Error: must run with root"
        exit 1
fi

############################################################
#
#       全局变量
#
############################################################
BACKUP_ROOT="/backup"
BACKUP_DIR="mysql"
LOG_DIR="log"

############################################################
#
#       处理变量
#
############################################################
if [[ -z "$ARGUMENT1" ]]; then
        ARGUMENT1="full"
fi

if [[ -z "$ARGUMENT2" ]]; then
        ARGUMENT2="backup"
fi

if [[ -z "$ARGUMENT3" ]]; then
        ARGUMENT3="list"
fi

############################################################
#
#       主要函数
#
############################################################
default()
{
        echo "default $1"
}

# 完全备份
full_backup()
{
        echo "full_backup"
}

# 完全恢复
full_restore()
{
        echo "full_restore $1"
}

# 增量备份
incremental_backup()
{
        echo "incremental_backup"
}

# 增量恢复
incremental_restore()
{
        echo "incremental_restore $1"
}

full_backup_list()
{
        echo "full_backup_list"
}

incremental_backup_list()
{
        echo "incremental_backup_list"
}

############################################################
#
#       主要操作
#
############################################################
mkdir -p ${BACKUP_ROOT}/{"$BACKUP_DIR","$LOG_DIR"}

case "$ARGUMENT1" in
        
        "full")
                
                case "$ARGUMENT2" in
                        
                        "backup")
                                full_backup
                          ;;
                        
                        "restore")
                                
                                case "$ARGUMENT3" in
                                        
                                        "list")
                                                full_backup_list
                                          ;;
                                        
                                        20[1-3][0-9]-[0-1][0-9]-[0-3][0-9]-[0-9][0-9][0-9][0-9][0-9][0-9])
                                                full_restore "$ARGUMENT3"
                                          ;;
                                        
                                        *)
                                                default "$ARGUMENT3"
                                          ;;
                                        
                                esac
                                
                          ;;
                        
                        *)
                                default "$ARGUMENT2"
                          ;;
                        
                esac
                
          ;;
        
        "incremental")
                
                case "$ARGUMENT2" in
                        
                        "backup")
                                incremental_backup
                          ;;
                        
                        "restore")
                                
                                case "$ARGUMENT3" in
                                        
                                        "list")
                                                incremental_backup_list
                                          ;;
                                        
                                        20[1-3][0-9]-[0-1][0-9]-[0-3][0-9]-[0-9][0-9][0-9][0-9][0-9][0-9])
                                                incremental_restore "$ARGUMENT3"
                                          ;;
                                        
                                        *)
                                                default "$ARGUMENT3"
                                          ;;
                                        
                                esac
                                
                          ;;
                        
                        *)
                                default "$ARGUMENT2"
                          ;;
                        
                esac
                
          ;;
        
        *)
                default "$ARGUMENT1"
          ;;
        
esac
